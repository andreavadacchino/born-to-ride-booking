<?php// Recupera il valore salvato dal database$btr_tipologia_prenotazione = get_post_meta($post->ID, 'btr_tipologia_prenotazione', true);// Imposta un valore di default se il valore è vuoto o nulloif (empty($btr_tipologia_prenotazione)) {    $btr_tipologia_prenotazione = 'per_tipologia_camere'; // Default: per tipologia di camere}?><div class="btr-section active">    <h2>Tipologia di prenotazione</h2>    <div class="section-content">        <p>Seleziona il tipo di gestione delle prenotazioni:</p>        <div class="btr-option-cards">            <fieldset class="radio-group">                <div class="radio">                    <label class="radio-wrapper">                        <input type="radio" name="btr_tipologia_preno" class="radio-input" value="per_tipologia_camere"                            <?php checked($btr_tipologia_prenotazione, 'per_tipologia_camere'); ?> />                        <span class="radio-tile">                            <span class="radio-label">Gestione per tipologia di camere</span>                            <span class="radio-desc">Scegli la tipologia di camere per definire le opzioni di prenotazione.</span>                            <span class="radio-check"></span>                        </span>                    </label>                </div>                <div class="radio">                    <label class="radio-wrapper">                        <input type="radio" name="btr_tipologia_preno" class="radio-input" value="per_numero_persone"                            <?php checked($btr_tipologia_prenotazione, 'per_numero_persone'); ?> />                        <span class="radio-tile">                            <span class="radio-label">Gestione per numero di persone</span>                            <span class="radio-desc">Imposta la gestione delle prenotazioni in base al numero di persone.</span>                            <span class="radio-check"></span>                        </span>                    </label>                </div>                <div class="radio">                    <label class="radio-wrapper">                        <input type="radio" name="btr_tipologia_preno" class="radio-input" value="allotment_camere"                            <?php checked($btr_tipologia_prenotazione, 'allotment_camere'); ?> />                        <span class="radio-tile">                            <span class="radio-label">Gestione con allotment camere</span>                            <span class="radio-desc">Assegna un numero di camere disponibili. Le prenotazioni verranno scalate dall’allotment.</span>                            <span class="radio-check"></span>                        </span>                    </label>                </div>            </fieldset>            <input type="hidden" id="btr_tipologia_prenotazione" name="btr_tipologia_prenotazione" value="<?php echo esc_attr($btr_tipologia_prenotazione); ?>"/>            <small>Scegli come gestire le prenotazioni per questo pacchetto.</small>        </div>    </div></div><!-- Sezione Dettagli Generali --><div class="btr-section collapsible active">    <h2 class="btr-section-title">        Destinazione del pacchetto    </h2>    <div class="section-content">        <div class="btr-field-group required">            <label for="btr_destinazione" class="btr-label-destinazione">Destinazione</label>            <input                    type="text"                    id="btr_destinazione"                    name="btr_destinazione"                    class="btr-destinazione-input"                    value="<?php echo esc_attr($btr_destinazione); ?>"                    placeholder="Inserisci qui la destinazione del pacchetto"            />            <small class="btr-field-description">Ad esempio: "Born to Ride Weekend".</small>        </div>        <div class="btr-field-group required">            <label for="btr_destinazione" class="btr-label-destinazione">Località destinazione</label>            <input                    type="text"                    id="btr_localita_destinazione"                    name="btr_localita_destinazione"                    class="btr-destinazione-input"                    value="<?php echo esc_attr($btr_localita_destinazione); ?>"                    placeholder="Inserisci qui la località della destinazione del pacchetto"            />            <small class="btr-field-description">Ad esempio: "Bardonecchia".</small>        </div>    </div></div><!-- Inizio gestione pagina pubblica dinamica - stile moderno WordPress --><div class="btr-section btr-room-row">    <div class="btr-section collapsible active">        <h2 class="btr-section-title">Pagina pubblica del pacchetto</h2>        <div class="section-content">            <div class="btr-switch-container">                <input type="checkbox"                       name="btr_attiva_pagina_pubblica"                       id="btr_attiva_pagina_pubblica"                       value="1"                       onclick="document.getElementById('btr-pagina-pubblica-settings').style.display = this.checked ? 'block' : 'none';"                    <?php checked(get_post_meta($post->ID, 'btr_attiva_pagina_pubblica', true), '1'); ?> />                <label class="btr-switch" for="btr_attiva_pagina_pubblica">                                <span class="btr-switch-handle">                                    <svg class="btr-switch-icon btr-switch-icon--on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                        <path fill-rule="evenodd"                                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"                                              clip-rule="evenodd"/>                                    </svg>                                    <svg class="btr-switch-icon btr-switch-icon--off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                        <path fill-rule="evenodd"                                              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"                                              clip-rule="evenodd"/>                                    </svg>                                </span>                </label>                <label for="btr_attiva_pagina_pubblica">Abilita la pagina pubblica per questo                    pacchetto <?= info_desc('Se abilitato, verrà generata una pagina visibile pubblicamente. Se disabilitato, il modulo sarà accessibile solo agli admin o tramite shortcode.'); ?></label>            </div>            <div id="btr-pagina-pubblica-settings"                 style="margin-top: 1em; display: <?php echo get_post_meta($post->ID, 'btr_attiva_pagina_pubblica', true) ? 'block' : 'none'; ?>;">                <?php                $base_url = trailingslashit(get_site_url());                $slug = get_post_meta($post->ID, 'btr_slug_pagina_pubblica', true);                $titolo = get_the_title($post->ID);                $pagina_pubblica_id = get_post_meta($post->ID, 'btr_pagina_pubblica_id', true);                if (empty($slug) && !empty($titolo)) {                    $slug = sanitize_title($titolo);                }                $preview_url = esc_url($base_url . $slug);                ?>                <div class="btr-field-group">                    <label for="btr_slug_pagina_pubblica"><strong>Permalink personalizzato</strong></label>                    <input type="text" id="btr_slug_pagina_pubblica" name="btr_slug_pagina_pubblica"                           class="regular-text btr-destinazione-input"                           value="<?php echo esc_attr($slug); ?>"                           placeholder="inserisci-slug-pagina"                           oninput="btrUpdatePreviewPermalink(this.value)"                    />                    <small class="btr-field-description">                        Inserisci uno slug user-friendly (senza spazi, solo lettere, numeri e trattini). L’URL sarà aggiornato in tempo reale.                    </small>                    <div class="btr-permalink-wrapper" style="margin-bottom: 8px; display: flex; gap: 10px; align-items: center;">                        <code id="btr_permalink_preview"><?php echo $preview_url; ?></code>                        <button type="button" class="button button-small" onclick="navigator.clipboard.writeText(document.getElementById('btr_permalink_preview').innerText)">                            Copia                        </button>                        <a href="<?php echo esc_url($preview_url); ?>" target="_blank" class="button button-small">Anteprima</a>                    </div>                </div>                <?php                if ($pagina_pubblica_id && get_post_status($pagina_pubblica_id) !== false) {                    $pagina_link = get_permalink($pagina_pubblica_id);                    echo '<div class="btr-field-group"><strong>Link generato:</strong> <a href="' . esc_url($pagina_link) . '" target="_blank">' . esc_html($pagina_link) . '</a></div>';                }                ?>                <script>                    function btrUpdatePreviewPermalink(slug) {                        const base = '<?php echo esc_js($base_url); ?>';                        const sanitized = slug.toLowerCase()                            .replace(/[^\w\-]+/g, '-')   // sostituisce caratteri non validi                            .replace(/\-\-+/g, '-')      // rimuove trattini doppi                            .replace(/^-+|-+$/g, '');    // rimuove trattini all'inizio/fine                        document.getElementById('btr_permalink_preview').innerText = base + sanitized;                    }                </script>            </div>        </div>    </div></div><!-- Fine gestione pagina pubblica dinamica --><!-- Controllo prenotazione abilitata/disabilitata --                <div class="btr-section active">                    <h2>Stato prenotazioni</h2>                    <div class="section-content">                        <div class="btr-field-group" style="gap: 0; margin-bottom: 1.5em">                        <div class="btr-switch-container">                            <label for="btr_prenotazione_disabilitata" class="label_btr_prenotazione_disabilitata"><strong>Chiudi prenotazioni</strong></label>                            <input type="checkbox" id="btr_prenotazione_disabilitata" name="btr_prenotazione_disabilitata" value="1" <?php checked(get_post_meta($post->ID, 'btr_prenotazione_disabilitata', true), '1'); ?> >                            <label class="btr-switch" for="btr_prenotazione_disabilitata">                                 <span class="btr-switch-handle">                                    <svg class="btr-switch-icon btr-switch-icon--on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>                                    </svg>                                    <svg class="btr-switch-icon btr-switch-icon--off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>                                    </svg>                                </span>                            </label>                        </div>                        <small class="btr-field-description">Abilita per disattivare le prenotazioni di questo pacchetto.</small>                        </div>                        <div class="btr-field-group required">                            <label for="btr_prenotazione_disabilitata_label" class="btr-label-destinazione">Etichetta personalizzata da mostrare:</label>                            <input type="text" id="btr_prenotazione_disabilitata_label" name="btr_prenotazione_disabilitata_label" class="btr-destinazione-input valid"                                   value="<?php echo esc_attr(get_post_meta($post->ID, 'btr_prenotazione_disabilitata_label', true) ?: 'Sold Out'); ?>"                                   placeholder="Inserisci qui l'etichetta personalizzata'" aria-invalid="false">                            <small class="btr-field-description">Ad esempio: "Sold Out", "Chiuse", "Posti esauriti", ecc.</small>                        </div>                    </div>                </div>                -->