<!-- Sezione Badge Giacenze --><div class="btr-section collapsible active btr-extra-costs-section">    <h2>Badge Giacenze Camere</h2>    <div class="section-content">        <!-- Contenuto introduttivo badge -->        <p class="description">Definisci uno o pi√π badge visivi da mostrare in base alla disponibilit√† residua delle camere. Ogni badge pu√≤ essere attivato/disattivato e personalizzato per soglia, testo e stile.</p>        <div class="btr-badge-help-box" style="background:#fefefe; border-left:4px solid #0073aa; padding:15px 20px; margin:15px 0; border-radius:6px;">            <h3 style="margin-top:0;">üìò Come funzionano i badge</h3>            <p>I badge ti permettono di mostrare in automatico un'etichetta visiva (es. ‚ÄúUltime camere‚Äù, ‚ÄúSold out‚Äù) in base alla disponibilit√† residua di camere.</p>            <ul style="padding-left: 20px; list-style-type: disc;">                <li><strong>Condizione:</strong> viene confrontata con la <u>disponibilit√† residua</u> di camere.</li>                <li><strong>Soglia:</strong> numero che attiva la regola (es. 1, 3, 10).</li>                <li><strong>Etichetta:</strong> il testo che verr√† mostrato (es. ‚ÄúUltima camera!‚Äù).</li>                <li><strong>Classe CSS:</strong> seleziona lo stile visivo del badge (colore e forma).</li>            </ul>            <p><strong>Esempi pratici:</strong></p>            <ul style="padding-left: 20px; list-style-type: square;">                <li><code>Condizione: ‚â§</code>, <code>Soglia: 1</code> ‚Üí Badge con etichetta ‚ÄúUltima camera disponibile‚Äù (colore arancione).</li>                <li><code>Condizione: &lt;</code>, <code>Soglia: 5</code> ‚Üí Badge con etichetta ‚ÄúAffrettati, quasi esaurito!‚Äù (colore rosso chiaro).</li>                <li><code>Condizione: =</code>, <code>Soglia: 0</code> ‚Üí Badge con etichetta ‚ÄúSold out‚Äù (colore rosso).</li>            </ul>        </div>        <div id="btr-badge-rules-container">            <?php            // Recupero e inizializzazione sicura delle regole badge            $btr_badge_rules = get_post_meta($post->ID, 'btr_badge_rules', true);            if (!is_array($btr_badge_rules)) {                $btr_badge_rules = [];            }            if (!empty($btr_badge_rules) && is_array($btr_badge_rules)) {                foreach ($btr_badge_rules as $index => $rule) {                    ?>                    <div class="btr-badge-rule btr-extra-cost-card">                        <span class="dashicons dashicons-move drag-handle"></span>                        <div class="btr-extra-cost-fields">                            <div class="btr-field-group">                                <label>Condizione</label>                                <select name="btr_badge_rules[<?php echo $index; ?>][condizione]">                                    <option value="eq" <?php selected($rule['condizione'], 'eq'); ?>>= (Uguale a)</option>                                    <option value="lt" <?php selected($rule['condizione'], 'lt'); ?>>&lt; (Minore di)</option>                                    <option value="lte" <?php selected($rule['condizione'], 'lte'); ?>>&le; (Minore o uguale a)</option>                                    <option value="gt" <?php selected($rule['condizione'], 'gt'); ?>>&gt; (Maggiore di)</option>                                    <option value="gte" <?php selected($rule['condizione'], 'gte'); ?>>&ge; (Maggiore o uguale a)</option>                                </select>                            </div>                            <div class="btr-field-group">                                <label>Soglia</label>                                <input type="number" name="btr_badge_rules[<?php echo $index; ?>][soglia]" value="<?php echo esc_attr($rule['soglia']); ?>" min="0" />                            </div>                            <div class="btr-field-group">                                <label>Etichetta</label>                                <input type="text" name="btr_badge_rules[<?php echo $index; ?>][label]" value="<?php echo esc_attr($rule['label']); ?>" placeholder="Es. Ultimi Posti" />                            </div>                            <div class="btr-field-group">                                <label>Classe CSS</label>                                <div class="container-selct-badge">                                    <select name="btr_badge_rules[<?php echo $index; ?>][class]">                                        <option value="">-- Seleziona uno stile --</option>                                        <option value="btr-badge-soldout" <?php selected($rule['class'], 'btr-badge-soldout'); ?>>Rosso (Esaurito / Sold Out)</option>                                        <option value="btr-badge-last-one" <?php selected($rule['class'], 'btr-badge-last-one'); ?>>Arancione (Ultima Camera)</option>                                        <option value="btr-badge-few-left" <?php selected($rule['class'], 'btr-badge-few-left'); ?>>Rosso Chiaro (Ultime Camere)</option>                                        <option value="btr-badge-info" <?php selected($rule['class'], 'btr-badge-info'); ?>>Blu (Informativo)</option>                                        <option value="btr-badge-available" <?php selected($rule['class'], 'btr-badge-available'); ?>>Verde (Disponibile)</option>                                        <option value="btr-badge-gray-light" <?php selected($rule['class'], 'btr-badge-gray-light'); ?>>Grigio Chiaro</option>                                        <option value="btr-badge-gray-dark" <?php selected($rule['class'], 'btr-badge-gray-dark'); ?>>Grigio Scuro</option>                                        <option value="btr-badge-black" <?php selected($rule['class'], 'btr-badge-black'); ?>>Nero</option>                                        <option value="btr-badge-purple" <?php selected($rule['class'], 'btr-badge-purple'); ?>>Viola</option>                                        <option value="btr-badge-teal" <?php selected($rule['class'], 'btr-badge-teal'); ?>>Teal</option>                                        <option value="btr-badge-yellow" <?php selected($rule['class'], 'btr-badge-yellow'); ?>>Giallo</option>                                        <option value="btr-badge-pink" <?php selected($rule['class'], 'btr-badge-pink'); ?>>Rosa</option>                                        <option value="btr-badge-indigo" <?php selected($rule['class'], 'btr-badge-indigo'); ?>>Indaco</option>                                        <option value="btr-badge-lime" <?php selected($rule['class'], 'btr-badge-lime'); ?>>Lime</option>                                        <option value="btr-badge-brown" <?php selected($rule['class'], 'btr-badge-brown'); ?>>Marrone</option>                                    </select>                                    <span class="btr-badge-preview"><span></span></span>                                </div>                            </div>                            <div class="btr-switch-container">                                <label for="btr_badge_enabled_<?php echo $index; ?>">Attivo</label>                                <input type="checkbox" id="btr_badge_enabled_<?php echo $index; ?>" name="btr_badge_rules[<?php echo $index; ?>][enabled]" value="1"                                    <?php checked(isset($rule['enabled']) ? $rule['enabled'] : '1', '1'); ?> />                                <label class="btr-switch" for="btr_badge_enabled_<?php echo $index; ?>">                                                    <span class="btr-switch-handle">                                                        <svg class="btr-switch-icon btr-switch-icon--on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"                                                                  clip-rule="evenodd"></path>                                                        </svg>                                                        <svg class="btr-switch-icon btr-switch-icon--off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                                            <path fill-rule="evenodd"                                                                  d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"                                                                  clip-rule="evenodd"></path>                                                        </svg>                                                    </span>                                </label>                            </div>                        </div>                        <button type="button" class="remove-item button">Rimuovi</button>                    </div>                    <?php                }            } else {                // Primo elemento se l'array √® vuoto                ?>                <div class="btr-badge-rule btr-extra-cost-card">                    <span class="dashicons dashicons-move drag-handle"></span>                    <div class="btr-extra-cost-fields">                        <div class="btr-field-group">                            <label>Condizione</label>                            <select name="btr_badge_rules[0][condizione]">                                <option value="eq">= (Uguale a)</option>                                <option value="lt">&lt; (Minore di)</option>                                <option value="lte">&le; (Minore o uguale a)</option>                                <option value="gt">&gt; (Maggiore di)</option>                                <option value="gte">&ge; (Maggiore o uguale a)</option>                            </select>                        </div>                        <div class="btr-field-group">                            <label>Soglia</label>                            <input type="number" name="btr_badge_rules[0][soglia]" value="0" min="0" />                        </div>                        <div class="btr-field-group">                            <label>Etichetta</label>                            <input type="text" name="btr_badge_rules[0][label]" value="" placeholder="Es. Ultimi Posti" />                        </div>                        <div class="btr-field-group">                            <label>Classe CSS</label>                            <select name="btr_badge_rules[0][class]">                                <option value="">-- Seleziona uno stile --</option>                                <option value="btr-badge-soldout">Rosso (Esaurito / Sold Out)</option>                                <option value="btr-badge-last-one">Arancione (Ultima Camera)</option>                                <option value="btr-badge-few-left">Rosso Chiaro (Ultime Camere)</option>                                <option value="btr-badge-info">Blu (Informativo)</option>                                <option value="btr-badge-available">Verde (Disponibile)</option>                                <option value="btr-badge-gray-light">Grigio Chiaro</option>                                <option value="btr-badge-gray-dark">Grigio Scuro</option>                                <option value="btr-badge-black">Nero</option>                                <option value="btr-badge-purple">Viola</option>                                <option value="btr-badge-teal">Teal</option>                                <option value="btr-badge-yellow">Giallo</option>                                <option value="btr-badge-pink">Rosa</option>                                <option value="btr-badge-indigo">Indaco</option>                                <option value="btr-badge-lime">Lime</option>                                <option value="btr-badge-brown">Marrone</option>                            </select>                            <span class="btr-badge-preview"><span></span></span>                        </div>                        <div class="btr-switch-container">                            <label for="btr_badge_enabled_0">Attivo</label>                            <input type="checkbox" id="btr_badge_enabled_0" name="btr_badge_rules[0][enabled]" value="1" checked />                            <label class="btr-switch" for="btr_badge_enabled_0">                                                <span class="btr-switch-handle">                                                    <svg class="btr-switch-icon btr-switch-icon--on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"                                                              clip-rule="evenodd"></path>                                                    </svg>                                                    <svg class="btr-switch-icon btr-switch-icon--off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">                                                        <path fill-rule="evenodd"                                                              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"                                                              clip-rule="evenodd"></path>                                                    </svg>                                                </span>                            </label>                        </div>                    </div>                    <button type="button" class="remove-item button">Rimuovi</button>                </div>                <?php            }            ?>        </div>        <button type="button" id="add-badge-rule" class="button btr-add-rule-button">+ Aggiungi nuova regola</button>    </div></div>