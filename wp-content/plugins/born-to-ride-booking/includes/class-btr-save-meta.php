<?phpif ( ! defined( 'ABSPATH' ) ) {    exit; // Impedisce l'accesso diretto}class BTR_Save_Meta {    public function __construct() {        add_action( 'save_post_btr_pacchetto', array( $this, 'save_metabox_data' ), 10, 3 );    }    public function save_metabox_data( $post_id, $post, $update ) {        // Verifica nonce        if ( ! isset( $_POST['btr_metabox_nonce'] ) || ! wp_verify_nonce( $_POST['btr_metabox_nonce'], 'btr_save_metabox' ) ) {            return;        }        // Verifica autorizzazione        if ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE ) {            return;        }        if ( ! current_user_can( 'edit_post', $post_id ) ) {            return;        }        // Elenco dei campi da salvare        $fields = array(            'btr_tipologia_prenotazione',            'btr_destinazione',            'btr_tipo_durata',            'btr_numero_giorni',            'btr_numero_giorni_fisse',            'btr_numero_notti',            'btr_prezzo_base',            'btr_moltiplica_prezzo_persone',            'btr_tariffa_base_fissa',            'btr_sconto_percentuale',            'btr_num_persone_max_case2',            'btr_ammessi_adulti',            'btr_ammessi_bambini',            'btr_num_singole',            'btr_num_doppie',            'btr_num_triple',            'btr_num_quadruple',            'btr_num_quintuple',            'btr_date_ranges',            'btr_costi_extra',            'btr_supplementi',            'btr_riduzioni',            'btr_include_items',            'btr_exclude_items',            'btr_assicurazione_importi',            'btr_payment_conditions'        );        foreach ( $fields as $field ) {            if ( isset( $_POST[ $field ] ) ) {                $value = sanitize_text_field( $_POST[ $field ] );                // Gestisci array e dati complessi                if ( is_array( $_POST[ $field ] ) ) {                    switch ( $field ) {                        case 'btr_date_ranges':                        case 'btr_costi_extra':                        case 'btr_supplementi':                        case 'btr_riduzioni':                        case 'btr_include_items':                        case 'btr_exclude_items':                        case 'btr_assicurazione_importi':                            $value = array_map( 'sanitize_text_field', $_POST[ $field ] );                            $value = maybe_serialize( $value );                            break;                        default:                            $value = sanitize_text_field( $_POST[ $field ] );                    }                }                update_post_meta( $post_id, $field, $value );            } else {                // Se il campo non Ã¨ impostato, elimina il meta                delete_post_meta( $post_id, $field );            }        }        // Sincronizza con WooCommerce        $sync = new BTR_Sync_WooCommerce();        $sync->sync_pacchetto( $post_id );    }}new BTR_Save_Meta();